
#############################Install the packages required ########################################################
install.packages(data.table)
library("data.table")
install.packages("dplyr")
library(dplyr)
install.packages("sqldf")
library(sqldf)
install.packages("dummy")
library(dummy)
install.packages("caTools")
library(caTools)
install.packages("naniar")
library(naniar)
install.packages("Information")
library(Information)

options(scipen = 999)

################################################### Reading in data##############################################
Originaltrain<-fread("train.csv",stringsAsFactors = FALSE ,na.strings = c(""))


#################################################### Check for missing values#####################################
missing_values <- miss_var_summary(train)

##Visualize missing data
missing_values <- missing_values %>% filter(n_miss != 0)
q <- ggplot(missing_values, aes(x= reorder(variable,-pct_miss),y=pct_miss)) + 
  geom_bar(position="dodge", stat="identity",color='black',fill='black') # flip our plot so the labels are easier to read
q + theme(axis.text.x = element_text(angle = 90, hjust = 1))

###############Drop all variables that had over 30% missing values compared to the total population################
NewData <- select(Originaltrain, -DefaultBrowsersIdentifier, -Census_IsFlightingInternal,
                  -Census_ThresholdOptIn, -Census_IsWIMBootEnabled,
                  -OrganizationIdentifier,-PuaMode,-Census_ProcessorClass,
                  -Census_InternalBatteryType)

###############Take a startified sample using the dependent variable############################################### 
set.seed(1000)
train_rows = sample.split(NewData$HasDetections, SplitRatio=0.1)
train = NewData[ train_rows,]
setDF(train)
table(train$HasDetections)

gc()

######################################## Check for unique values##################################################
# Check for unique values
unique<-as.data.frame(sapply(train,function(x) length(unique(x))))
names<-rownames(unique)
unique<-cbind(names,unique)
colnames(unique)<-c("Variable","Total_unique")

##Visualize unique values
unique <- unique %>% filter(Total_unique > 100)
q <- ggplot(unique, aes(x= reorder(Variable,-Total_unique),y=Total_unique)) + 
  geom_bar(position="dodge", stat="identity",color='black',fill='black') # flip our plot so the labels are easier to read
q + theme(axis.text.x = element_text(angle = 90, hjust = 1))

######################################  Imputing missing values################################################
#####Impute for numeric variables 
###Impute with mean
train$Census_ProcessorCoreCount <- impute_median(train$Census_ProcessorCoreCount)
train$Census_PrimaryDiskTotalCapacity <- impute_median(train$Census_PrimaryDiskTotalCapacity)
train$Census_SystemVolumeTotalCapacity  <- impute_median(train$Census_SystemVolumeTotalCapacity)
train$Census_TotalPhysicalRAM <- impute_median(train$Census_TotalPhysicalRAM)
train$Census_InternalPrimaryDiagonalDisplaySizeInInches  <- impute_median(train$Census_InternalPrimaryDiagonalDisplaySizeInInches)
train$Census_InternalPrimaryDisplayResolutionHorizontal <- impute_median(train$Census_InternalPrimaryDisplayResolutionHorizontal)
train$Census_InternalPrimaryDisplayResolutionVertical  <- impute_median(train$Census_InternalPrimaryDisplayResolutionVertical)
train$Census_InternalBatteryNumberOfCharges <- impute_median(train$Census_InternalBatteryNumberOfCharges)

###Change ensure that the numeric variables are numeric inorder to check for outliers
train$Census_ProcessorCoreCount <- as.numeric(train$Census_ProcessorCoreCount)
train$Census_SystemVolumeTotalCapacity  <- as.numeric(train$Census_SystemVolumeTotalCapacity)
train$Census_InternalPrimaryDisplayResolutionHorizontal <- as.numeric(train$Census_InternalPrimaryDisplayResolutionHorizontal)
train$Census_InternalPrimaryDisplayResolutionVertical  <- as.numeric(train$Census_InternalPrimaryDisplayResolutionVertical)

#### Visualizing outliers
NumericMB <- train[,c("Census_PrimaryDiskTotalCapacity","Census_SystemVolumeTotalCapacity","Census_TotalPhysicalRAM")]
par(mfrow=c(1,3))
for(i in 1:3) {
  boxplot(NumericMB[,i], main=names(NumericMB)[i])
}

##others
Numericother <- train[,c("Census_ProcessorCoreCount","Census_InternalPrimaryDiagonalDisplaySizeInInches","Census_InternalPrimaryDisplayResolutionHorizontal","Census_InternalPrimaryDisplayResolutionVertical","Census_InternalBatteryNumberOfCharges")]
par(mfrow=c(1,3))
for(i in 1:3) {
  boxplot(Numericother[,i], main=names(Numericother)[i])
}

##perform winsorization for numeric variables
var_winsorize <- c("Census_ProcessorCoreCount","Census_InternalPrimaryDiagonalDisplaySizeInInches","Census_InternalPrimaryDisplayResolutionHorizontal","Census_InternalPrimaryDisplayResolutionVertical","Census_InternalBatteryNumberOfCharges","Census_PrimaryDiskTotalCapacity","Census_SystemVolumeTotalCapacity","Census_TotalPhysicalRAM")
for(var in var_winsorize)
{
  LL = mean(train[,var])-3*sd(train[,var])
  UL = mean(train[,var])+3*sd(train[,var])
  toreplaceLL = which(train[,var]<LL)
  train[toreplaceLL ,var] = LL
  toreplaceUL = which(train[,var]>UL)
  train[toreplaceUL ,var] = UL
}
####Impute categorical variables with new category missing
x = "Missing"
train$Wdft_RegionIdentifier[which(is.na(train$Wdft_RegionIdentifier))] = x
train$Wdft_IsGamer[which(is.na(train$Wdft_IsGamer))] = x
train$UacLuaenable[which(is.na(train$UacLuaenable))] = x
train$SMode[which(is.na(train$SMode))] = x
train$SmartScreen[which(is.na(train$SmartScreen))] = x
train$RtpStateBitfield[which(is.na(train$RtpStateBitfield))] = x
train$OsBuildLab[which(is.na(train$OsBuildLab))] = x
train$IsProtected[which(is.na(train$IsProtected))] = x
train$IeVerIdentifier[which(is.na(train$IeVerIdentifier))] = x
train$GeoNameIdentifier[which(is.na(train$GeoNameIdentifier))] = x
train$Firewall[which(is.na(train$Firewall))] = x
train$CityIdentifier[which(is.na(train$CityIdentifier))] = x
train$Census_ProcessorModelIdentifier[which(is.na(train$Census_ProcessorModelIdentifier))] = x
train$Census_ProcessorManufacturerIdentifier[which(is.na(train$Census_ProcessorManufacturerIdentifier))] = x
train$Census_PrimaryDiskTypeName[which(is.na(train$Census_PrimaryDiskTypeName))] = x
train$Census_PowerPlatformRoleName[which(is.na(train$Census_PowerPlatformRoleName))] = x
train$Census_OSInstallLanguageIdentifier[which(is.na(train$Census_OSInstallLanguageIdentifier))] = x
train$Census_OEMNameIdentifier[which(is.na(train$Census_OEMNameIdentifier))] = x
train$Census_OEMModelIdentifier[which(is.na(train$Census_OEMModelIdentifier))] = x
train$Census_IsVirtualDevice[which(is.na(train$Census_IsVirtualDevice))] = x
train$Census_IsFlightsDisabled[which(is.na(train$Census_IsFlightsDisabled))] = x
train$Census_IsAlwaysOnAlwaysConnectedCapable[which(is.na(train$Census_IsAlwaysOnAlwaysConnectedCapable))] = x
train$Census_FirmwareVersionIdentifier[which(is.na(train$Census_FirmwareVersionIdentifier))] = x
train$Census_FirmwareManufacturerIdentifier[which(is.na(train$Census_FirmwareManufacturerIdentifier))] = x
train$Census_ChassisTypeName[which(is.na(train$Census_ChassisTypeName))] = x
train$AVProductStatesIdentifier[which(is.na(train$AVProductStatesIdentifier))] = x
train$AVProductsInstalled[which(is.na(train$AVProductsInstalled))] = x
train$AVProductsEnabled[which(is.na(train$AVProductsEnabled))] = x

############################################ Dealing with categorical variables with many classes################
########################Tactic 1: Frequency encoding for categorical variables #total unique >1000
#Convert to factor
train$Census_OEMModelIdentifier <- as.character(train$Census_OEMModelIdentifier)
train$CityIdentifier <- as.character(train$CityIdentifier)
train$Census_FirmwareVersionIdentifier <- as.character(train$Census_FirmwareVersionIdentifier)
train$Census_OEMNameIdentifier <- as.character(train$Census_OEMNameIdentifier)
train$Census_ProcessorModelIdentifier <- as.character(train$Census_ProcessorModelIdentifier)
train$AVProductStatesIdentifier <- as.character(train$AVProductStatesIdentifier)
train$AvSigVersion <- as.character(train$AvSigVersion)


##Create new variable with frequency encoding
train <- merge(train, data.frame(table(Census_OEMModelIdentifier = train$Census_OEMModelIdentifier)/nrow(train)), by = c("Census_OEMModelIdentifier"))
#rename the freq column
names(train)[76] <- "Freq_Census_OEMModelIdentifier"
##Delete original column
train$Census_OEMModelIdentifier <- NULL

train <- merge(train, data.frame(table(CityIdentifier = train$CityIdentifier)/nrow(train)), by = c("CityIdentifier"))
names(train)[76] <- "Freq_CityIdentifier"
#length(unique(train$Freq_CityIdentifier))
##Delete original column
train$CityIdentifier <- NULL


train <- merge(train, data.frame(table(Census_FirmwareVersionIdentifier = train$Census_FirmwareVersionIdentifier)/nrow(train)), by = c("Census_FirmwareVersionIdentifier"))
#rename the freq column
names(train)[76] <- "Freq_FirmwareVersionIdentifier"
##Delete original column
train$Census_FirmwareVersionIdentifier <- NULL

train <- merge(train, data.frame(table(Census_OEMNameIdentifier = train$Census_OEMNameIdentifier)/nrow(train)), by = c("Census_OEMNameIdentifier"))
#rename the freq column
names(train)[76] <- "Freq_Census_OEMNameIdentifier"
##Delete original column
train$Census_OEMNameIdentifier <- NULL

train <- merge(train, data.frame(table(Census_ProcessorModelIdentifier = train$Census_ProcessorModelIdentifier)/nrow(train)), by = c("Census_ProcessorModelIdentifier"))
#rename the freq column
names(train)[76] <- "Freq_Census_ProcessorModelIdentifier"
##Delete original column
train$Census_ProcessorModelIdentifier <- NULL

train <- merge(train, data.frame(table(CountryIdentifier = train$CountryIdentifier)/nrow(train)), by = c("CountryIdentifier"))
#rename the freq column
names(train)[76] <- "Freq_CountryIdentifier"
##Delete original column
train$CountryIdentifier <- NULL

train <- merge(train, data.frame(table(AVProductStatesIdentifier = train$AVProductStatesIdentifier)/nrow(train)), by = c("AVProductStatesIdentifier"))
#rename the freq column
names(train)[76] <- "Freq_AVProductStatesIdentifier"
##Delete original column
train$AVProductStatesIdentifier <- NULL

train <- merge(train, data.frame(table(AvSigVersion = train$AvSigVersion)/nrow(train)), by = c("AvSigVersion"))
#rename the freq column
names(train)[76] <- "Freq_AvSigVersion"
##Delete original column
train$AvSigVersion  <- NULL

##########################################################################################################
##########Tactic2 : Combining levels
#Census_PrimaryDiskTotalCapacity
Census_PrimaryDiskTotalCapacity <- as.data.frame(table(train$Census_PrimaryDiskTotalCapacity))
Census_PrimaryDiskTotalCapacity$perc <- (Census_PrimaryDiskTotalCapacity$Freq/nrow(train))*100

DiskCapacity <-sqldf("select  MachineIdentifier,Census_PrimaryDiskTotalCapacity,
  case
                               when Census_PrimaryDiskTotalCapacity between 0 and 500000 then 1
                               when Census_PrimaryDiskTotalCapacity between 500001 and 999999 then 2
                               else 3
                               end as PrimaryDiskTotalCapacity
                               from train")

DiskCapacity$PrimaryDiskTotalCapacity[DiskCapacity$PrimaryDiskTotalCapacity == 1] <- "Less500GB"
DiskCapacity$PrimaryDiskTotalCapacity[DiskCapacity$PrimaryDiskTotalCapacity == 2] <- "Over500GB_Less1TB"
DiskCapacity$PrimaryDiskTotalCapacity[DiskCapacity$PrimaryDiskTotalCapacity == 3] <- "Over1TB"

DiskCapacity$Census_PrimaryDiskTotalCapacity <- NULL

train <- merge(x = train, y = DiskCapacity, by = "MachineIdentifier", all.x = TRUE)
train$Census_PrimaryDiskTotalCapacity <- NULL

##########################################################################################################
#Census_SystemVolumeTotalCapacity
Census_SystemVolumeTotalCapacity <- as.data.frame(table(train$Census_SystemVolumeTotalCapacity))
Census_SystemVolumeTotalCapacity$perc <- (Census_SystemVolumeTotalCapacity$Freq/nrow(train))*100

SystemVolumeTotalCapacity <-sqldf("select  MachineIdentifier,Census_SystemVolumeTotalCapacity,
                     case
                     when Census_SystemVolumeTotalCapacity between 0 and 500000 then 1
                     when Census_SystemVolumeTotalCapacity between 500001 and 999999 then 2
                     else 3
                     end as SystemVolumeTotalCapacity
                     from train")

SystemVolumeTotalCapacity$SystemVolumeTotalCapacity[SystemVolumeTotalCapacity$SystemVolumeTotalCapacity == 1] <- "Less500GB"
SystemVolumeTotalCapacity$SystemVolumeTotalCapacity[SystemVolumeTotalCapacity$SystemVolumeTotalCapacity == 2] <- "Over500GB_Less1TB"
SystemVolumeTotalCapacity$SystemVolumeTotalCapacity[SystemVolumeTotalCapacity$SystemVolumeTotalCapacity == 3] <- "Over1TB"

SystemVolumeTotalCapacity$Census_SystemVolumeTotalCapacity <- NULL

train <- merge(x = train, y = SystemVolumeTotalCapacity, by = "MachineIdentifier", all.x = TRUE)
train$Census_SystemVolumeTotalCapacity <- NULL
############################################################
#Census_TotalPhysicalRAM
Census_TotalPhysicalRAM <- as.data.frame(table(train$Census_TotalPhysicalRAM))
Census_TotalPhysicalRAM$perc <- (Census_TotalPhysicalRAM$Freq/nrow(train))*100

TotalPhysicalRAM <-sqldf("select  MachineIdentifier,Census_TotalPhysicalRAM,
                                  case
                                  when Census_TotalPhysicalRAM between 0 and 500000 then 1
                                  when Census_TotalPhysicalRAM between 500001 and 999999 then 2
                                  else 3
                                  end as TotalPhysicalRAM
                                  from train")

TotalPhysicalRAM$TotalPhysicalRAM[TotalPhysicalRAM$TotalPhysicalRAM == 1] <- "Less500GB"
TotalPhysicalRAM$TotalPhysicalRAM[TotalPhysicalRAM$TotalPhysicalRAM == 2] <- "Over500GB_Less1TB"
TotalPhysicalRAM$TotalPhysicalRAM[TotalPhysicalRAM$TotalPhysicalRAM == 3] <- "Over1TB"

TotalPhysicalRAM$Census_TotalPhysicalRAM <- NULL

train <- merge(x = train, y = TotalPhysicalRAM, by = "MachineIdentifier", all.x = TRUE)
train$Census_TotalPhysicalRAM <- NULL
################################################################################################################
##Other tactic: (merging less categories into one called others)
####Census_PowerPlatformRoleName
Census_PowerPlatformRoleName <- as.data.frame(table(train$Census_PowerPlatformRoleName))
Census_PowerPlatformRoleName$perc <- (Census_PowerPlatformRoleName$Freq/nrow(train))*100

###Rename all other value that arent mobile,desktop or slate to others
train$Census_PowerPlatformRoleName[train$Census_PowerPlatformRoleName %in% c("Unspecified","PerformanceServer","AppliancePC","EnterpriseServer","UNKNOWN","SOHOServer","Workstation")] <- "Others"

sum(is.na(NewData$Census_PowerPlatformRoleName))

###############################################################################################################
##SmartScreen
table(train$SmartScreen)
train$SmartScreen[train$SmartScreen %in% c("off","Off")] <- "Off"
train$SmartScreen[train$SmartScreen %in% c("requireadmin","RequireAdmin")] <- "RequireAdmin"
train$SmartScreen[train$SmartScreen %in% c("on","On")] <- "On"
train$SmartScreen[train$SmartScreen %in% c("&#x01;","&#x02;")] <- "Other"
##########################################################################################################
##### Tactic :Weight of evidence for the rest of the variables
colname <- train[, sapply(train, class) == 'character']
variables <-  c("ProductName","TotalPhysicalRAM","SystemVolumeTotalCapacity","PrimaryDiskTotalCapacity","Census_FlightRing"
                 ,"Census_ActivationChannel","Census_GenuineStateName","Census_OSWUAutoUpdateOptionsName","Census_OSInstallTypeName"
                ,"Census_OSArchitecture","Census_OSVersion","Census_PowerPlatformRoleName","Census_OSSkuName","Census_OSEdition"
                ,"Census_OSBranch","Census_ChassisTypeName","Census_PrimaryDiskTypeName","Census_DeviceFamily","Census_MDC2FormFactor"
                ,"SmartScreen","SkuEdition","OsBuildLab","OsPlatformSubRelease","OsVer","Processor","Platform","AvSigVersion","AppVersion"
                ,"EngineVersion")

#https://www.listendata.com/2015/03/weight-of-evidence-woe-and-information.html
variables <- colnames(train)

## Ensure that all variables to use for WOE are character type except the response variable
train[variables] <- lapply(train[variables], as.character) 
train$HasDetections <- as.numeric(train$HasDetections)

##Perform IV formular to the dataset
IV <- create_infotables(data=train, y='HasDetections', parallel = FALSE)

##Review the WOE values
IV$Tables
Information_Gain <- data.frame(IV$Summary)

## drop variables with less than 0.00005 information gain as they prove to have no additional value to the model
train <- select(train, -OsVer, -Census_IsPortableOperatingSystem,
                  -Census_IsFlightsDisabled, -ProductName,
                  -Census_IsSecureBootEnabled,-IsBeta,-AutoSampleOptIn,
                  -TotalPhysicalRAM)

######################################################################Create WOE tables for the remaining high cardinality categorical variables
## SystemVolumeTotalCapacity
SystemVolumeTotalCapacity = data.frame(IV$Tables$SystemVolumeTotalCapacity)
SystemVolumeTotalCapacity = SystemVolumeTotalCapacity[,c(1,4)]

##merge
train <- merge(x = train, y = SystemVolumeTotalCapacity, by = 'SystemVolumeTotalCapacity',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "SystemVolumeTotalCapacity_WOE" # Rename column
train$SystemVolumeTotalCapacity <- NULL

## PrimaryDiskTotalCapacity
PrimaryDiskTotalCapacity = data.frame(IV$Tables$PrimaryDiskTotalCapacity)
PrimaryDiskTotalCapacity = PrimaryDiskTotalCapacity[,c(1,4)]

##merge
train <- merge(x = train, y = PrimaryDiskTotalCapacity , by = 'PrimaryDiskTotalCapacity',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "PrimaryDiskTotalCapacity_WOE" # Rename column
train$PrimaryDiskTotalCapacity <- NULL

## Census_FlightRing
Census_FlightRing = data.frame(IV$Tables$Census_FlightRing)
Census_FlightRing = Census_FlightRing[,c(1,4)]

##merge
train <- merge(x = train, y = Census_FlightRing , by = 'Census_FlightRing',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_FlightRing_WOE" # Rename column
train$Census_FlightRing <- NULL

## Census_ActivationChannel
Census_ActivationChannel = data.frame(IV$Tables$Census_ActivationChannel)
Census_ActivationChannel = Census_ActivationChannel[,c(1,4)]

##merge
train <- merge(x = train, y = Census_ActivationChannel , by = 'Census_ActivationChannel',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_ActivationChannel_WOE" # Rename column
train$Census_ActivationChannel <- NULL

## Census_ActivationChannel
Census_GenuineStateName = data.frame(IV$Tables$Census_GenuineStateName)
Census_GenuineStateName = Census_GenuineStateName[,c(1,4)]

##merge
train <- merge(x = train, y = Census_GenuineStateName , by = 'Census_GenuineStateName',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_GenuineStateName_WOE" # Rename column
train$Census_GenuineStateName <- NULL

## Census_OSWUAutoUpdateOptionsName
Census_OSWUAutoUpdateOptionsName = data.frame(IV$Tables$Census_OSWUAutoUpdateOptionsName)
Census_OSWUAutoUpdateOptionsName = Census_OSWUAutoUpdateOptionsName[,c(1,4)]

##merge
train <- merge(x = train, y = Census_OSWUAutoUpdateOptionsName , by = 'Census_OSWUAutoUpdateOptionsName',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_OSWUAutoUpdateOptionsName_WOE" # Rename column
train$Census_OSWUAutoUpdateOptionsName <- NULL

## Census_OSInstallTypeName
Census_OSInstallTypeName = data.frame(IV$Tables$Census_OSInstallTypeName)
Census_OSInstallTypeName = Census_OSInstallTypeName[,c(1,4)]

##merge
train <- merge(x = train, y = Census_OSInstallTypeName , by = 'Census_OSInstallTypeName',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_OSInstallTypeName_WOE" # Rename column
train$Census_OSInstallTypeName <- NULL

## Census_OSArchitecture
Census_OSArchitecture = data.frame(IV$Tables$Census_OSArchitecture)
Census_OSArchitecture = Census_OSArchitecture[,c(1,4)]

##merge
train <- merge(x = train, y = Census_OSArchitecture , by = 'Census_OSArchitecture',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_OSArchitecture_WOE" # Rename column
train$Census_OSArchitecture <- NULL

## Census_OSVersion
Census_OSVersion = data.frame(IV$Tables$Census_OSVersion)
Census_OSVersion = Census_OSVersion[,c(1,4)]

##merge
train <- merge(x = train, y = Census_OSVersion , by = 'Census_OSVersion',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_OSVersion_WOE" # Rename column
train$Census_OSVersion <- NULL

## Census_PowerPlatformRoleName
Census_PowerPlatformRoleName = data.frame(IV$Tables$Census_PowerPlatformRoleName)
Census_PowerPlatformRoleName = Census_PowerPlatformRoleName[,c(1,4)]

##merge
train <- merge(x = train, y = Census_PowerPlatformRoleName , by = 'Census_PowerPlatformRoleName',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_PowerPlatformRoleName_WOE" # Rename column
train$Census_PowerPlatformRoleName <- NULL

## Census_OSSkuName
Census_OSSkuName = data.frame(IV$Tables$Census_OSSkuName)
Census_OSSkuName = Census_OSSkuName[,c(1,4)]

##merge
train <- merge(x = train, y = Census_OSSkuName , by = 'Census_OSSkuName',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_OSSkuName_WOE" # Rename column
train$Census_OSSkuName <- NULL


## Census_OSEdition
Census_OSEdition = data.frame(IV$Tables$Census_OSEdition)
Census_OSEdition = Census_OSEdition[,c(1,4)]

##merge
train <- merge(x = train, y = Census_OSEdition , by = 'Census_OSEdition',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_OSEdition_WOE" # Rename column
train$Census_OSEdition <- NULL

## Census_OSBranch
Census_OSBranch = data.frame(IV$Tables$Census_OSBranch)
Census_OSBranch = Census_OSBranch[,c(1,4)]

##merge
train <- merge(x = train, y = Census_OSBranch , by = 'Census_OSBranch',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_OSBranch_WOE" # Rename column
train$Census_OSBranch<- NULL


## Census_ChassisTypeName
Census_ChassisTypeName = data.frame(IV$Tables$Census_ChassisTypeName)
Census_ChassisTypeName = Census_ChassisTypeName[,c(1,4)]

##merge
train <- merge(x = train, y = Census_ChassisTypeName , by = 'Census_ChassisTypeName',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_ChassisTypeName_WOE" # Rename column
train$Census_ChassisTypeName<- NULL


## Census_ChassisTypeName
Census_PrimaryDiskTypeName = data.frame(IV$Tables$Census_PrimaryDiskTypeName)
Census_PrimaryDiskTypeName = Census_PrimaryDiskTypeName[,c(1,4)]

##merge
train <- merge(x = train, y = Census_PrimaryDiskTypeName , by = 'Census_PrimaryDiskTypeName',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_PrimaryDiskTypeName_WOE" # Rename column
train$Census_PrimaryDiskTypeName<- NULL

## Census_DeviceFamily
Census_DeviceFamily = data.frame(IV$Tables$Census_DeviceFamily)
Census_DeviceFamily = Census_DeviceFamily[,c(1,4)]

##merge
train <- merge(x = train, y = Census_DeviceFamily , by = 'Census_DeviceFamily',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_DeviceFamily_WOE" # Rename column
train$Census_DeviceFamily<- NULL

## Census_MDC2FormFactor
Census_MDC2FormFactor = data.frame(IV$Tables$Census_MDC2FormFactor)
Census_MDC2FormFactor = Census_MDC2FormFactor[,c(1,4)]

##merge
train <- merge(x = train, y = Census_MDC2FormFactor , by = 'Census_MDC2FormFactor',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Census_MDC2FormFactor_WOE" # Rename column
train$Census_MDC2FormFactor<- NULL

## SmartScreen
SmartScreen = data.frame(IV$Tables$SmartScreen)
SmartScreen = SmartScreen[,c(1,4)]

##merge
train <- merge(x = train, y = SmartScreen , by = 'SmartScreen',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "SmartScreen_WOE" # Rename column
train$SmartScreen<- NULL


## SmartScreen
SkuEdition = data.frame(IV$Tables$SkuEdition)
SkuEdition= SkuEdition[,c(1,4)]

##merge
train <- merge(x = train, y = SkuEdition , by = 'SkuEdition',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "SkuEdition_WOE" # Rename column
train$SkuEdition<- NULL


## OsBuildLab
OsBuildLab = data.frame(IV$Tables$OsBuildLab)
OsBuildLab = OsBuildLab[,c(1,4)]

##merge
train <- merge(x = train, y = OsBuildLab , by = 'OsBuildLab',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "OsBuildLab_WOE" # Rename column
train$OsBuildLab<- NULL

## OsPlatformSubRelease
OsPlatformSubRelease = data.frame(IV$Tables$OsPlatformSubRelease)
OsPlatformSubRelease = OsPlatformSubRelease[,c(1,4)]

##merge
train <- merge(x = train, y = OsPlatformSubRelease , by = 'OsPlatformSubRelease',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "OsPlatformSubRelease_WOE" # Rename column
train$OsPlatformSubRelease<- NULL

## Processor
Processor = data.frame(IV$Tables$Processor)
Processor = Processor[,c(1,4)]

##merge
train <- merge(x = train, y = Processor , by = 'Processor',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Processor_WOE" # Rename column
train$Processor<- NULL

## Platform
Platform = data.frame(IV$Tables$Platform)
Platform = Platform[,c(1,4)]

##merge
train <- merge(x = train, y = Platform , by = 'Platform',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "Platform_WOE" # Rename column
train$Platform<- NULL

## AvSigVersion
AvSigVersion = data.frame(IV$Tables$AvSigVersion)
AvSigVersion = AvSigVersion[,c(1,4)]

##merge
train <- merge(x = train, y = AvSigVersion , by = 'AvSigVersion',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "AvSigVersion_WOE" # Rename column
train$AvSigVersion<- NULL

## AppVersion
AppVersion = data.frame(IV$Tables$AppVersion)
AppVersion = AppVersion[,c(1,4)]

##merge
train <- merge(x = train, y = AppVersion , by = 'AppVersion',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "AppVersion_WOE" # Rename column
train$AppVersion<- NULL

## EngineVersion
EngineVersion = data.frame(IV$Tables$EngineVersion)
EngineVersion = EngineVersion[,c(1,4)]

##merge
train <- merge(x = train, y = EngineVersion , by = 'EngineVersion',all.x = TRUE)
colnames(train)[colnames(train) == "WOE"] <- "EngineVersion_WOE" # Rename column
train$EngineVersion<- NULL

###write basetable to be used for modelling
basetable <- write.csv(train ,"basetable.csv")



